<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/tr/xhtml1/DTD/xhtml11.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb">
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src = "jQuery_Cookie_Plugin_4.1/jquery.cookie.js"></script>
<title>Login</title>
<meta name="Author" content="ad9047o@gre.ac.uk"/>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
    <body>
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <a class="navbar-brand" href="index.html">Home</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="register.html">Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">Login</a>
                    </li>                    
                </ul>
            </div>  
        </nav>
        <div class="headerlog">
            <img src="images/greenwichlogo.png" width="200px" height="50px"/>
                            
        </div>
        <form>
        <div class="contentlog">
<!--            <h5>Login into the service</h5>-->
            <div class="input-group">                
  		        <label>Username</label>
  		        <input type="text" name="username" id="username" required>
            </div>
            <div class="input-group">
  		        <label>Password</label>
  		        <input type="password" name="password" id="password" required>
            </div>
            <div class="input-group">
  		        <button type="button"  id="submitButton" class="refresh btn">Login </button>                

            </div>
<!--            <p id="testingSpace">   </p> -->
            <script>
                $(document).ready(function(){
                     
                    $("#submitButton").click(function(){
                           var username = $("#username").val();
                           var password = $("#password").val();
                        $.ajax({
                            type: "POST",
                            url: "LoginController.php",
                            data: {method:"login", username:username, password:password},
                            cache: false,
                            dataType: 'JSON',
                            success: function(output) {
                                    $("#testingSpace").text("login= "+output.login+" verified = " +output.verified+ " userid =" +output.user_id);
                                
                                if(output.login == true){
                                    
                                    $.cookie("userid", output.user_id);
                                    $.cookie("username", username);
                                    $.cookie("role", output.role_id);
                                    $.cookie("timeStamp", output.last_login)
                                    if(output.verified == false){
                                        window.location.href = "Verification.html";

                                    }else{
                                        window.location.href = "index.html";
                                    }
                                    
                                }else{
                                    alert('incorrect Login');
                                }
                            }
                            

                            });
            
                        
                    });
                               
                   
                               
               });
            
            
            
            </script>
  	         <p>
  		        Not yet a member? <a href="register.html">Sign up</a>
  	         </p>
         </div>
        </form>

    </body>
</html>